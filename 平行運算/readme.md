## 讀

筆數 | 時間(s) | 記憶體(mb)
1,000 | 0.011 | 10
10,000 | 0.03 | 15
50,000 | 0.143 | 28
100,000 | 0.27 | 35
500,000 | 1.128 | 144
1,000,000 | 2.304 | 273
2,000,000 | 4.703 | 538
5,000,000 | 11.64 | 1300
10,000,000| 34.5 | 2500

## 讀 + 寫

筆數 | 時間 | 記憶體
1,000 | 0.009 | 11
10,000 | 0.038 | 18
50,000 | 0.17 | 29
100,000 | 0.371 | 42
500,000 | 1.78 | 144
1,000,000 | 3.373 | 273
2,000,000 | 6.719 | 538
5,000,000 | 17.052 | 1300
10,000,000| 138.012 | 2500

## 分批讀取

分批 | 讀取筆數 | 時間 | 記憶體
100,000 | 1,000 | 0.004 | 10
100,000 | 10,000 | 0.023 | 15
100,000 | 50,000 | 0.113 | 28
100,000 | 100,000 | 0.264 | 40
100,000 | 500,000 | 1.339 | 100
100,000 | 1,000,000 | 2.972 | 94
100,000 | 2,000,000 | 7.525 | 102
100,000 | 5,000,000 | 30.208 | 106
100,000 | 10,000,000| 99.443 | 106

200,000 | 1,000 | 0.004 | 10
200,000 | 10,000 | 0.024 | 15
200,000 | 50,000 | 0.121 | 28
200,000 | 100,000 | 0.233 | 35
200,000 | 500,000 | 1.25 | 142
200,000 | 1,000,000 | 2.744 | 165
200,000 | 2,000,000 | 6.165 | 171
200,000 | 5,000,000 | 21.088 | 192
200,000 | 10,000,000| 61.568 | 196

500,000 | 1,000 | 0.004 | 10
500,000 | 10,000 | 0.024 | 15
500,000 | 50,000 | 0.121 | 28
500,000 | 100,000 | 0.233 | 35
500,000 | 500,000 | 1.241 | 144
500,000 | 1,000,000 | 2.414 | 270
500,000 | 2,000,000 | 5.194 | 400
500,000 | 5,000,000 | 15.202 | 439
500,000 | 10,000,000| 38.114 | 462

1,000,000 | 1,000 | 0.004 | 10
1,000,000 | 10,000 | 0.024 | 15
1,000,000 | 50,000 | 0.121 | 28
1,000,000 | 100,000 | 0.233 | 35
1,000,000 | 500,000 | 1.241 | 144
1,000,000 | 1,000,000 | 2.386 | 273
1,000,000 | 2,000,000 | 4.961 | 533
1,000,000 | 5,000,000 | 13.274 | 943
1,000,000 | 10,000,000| 30.542 | 943

2,000,000 | 2,000,000 | 4.961 | 533
2,000,000 | 5,000,000 | 11.729 | 1300
2,000,000 | 10,000,000| 26.311 | 1600
2,000,000 | 10,000,000| 26.298 | 1700

2,500,000 | 5,000,000 | 10.204 | 1300
2,500,000 | 5,000,000 | 12 | 1300
2,500,000 | 10,000,000| 25.89 | 1800
2,500,000 | 10,000,000| 33.264 | 1800

3,000,000 | 10,000,000| 24.571 | 1800
3,000,000 | 10,000,000| 26.024 | 1800

3,500,000 | 10,000,000| 24.35 | 2300
3,500,000 | 10,000,000| 23.869 | 2300

4,000,000 | 10,000,000| 26.371 | 2300

5,000,000 | 10,000,000| 53.109 | 2500

## 分批讀取 + 寫入

分批 | 筆數 | 時間 | 記憶體
2,000,000 | 5,000,000 | 16.794 | 1300
2,000,000 | 10,000,000| 36.724 | 1600
2,500,000 | 10,000,000| 36.393 | 1800
3,000,000 | 10,000,000| 35.116 | 1800
3,500,000 | 10,000,000| 34.656 | 2300
4,000,000 | 10,000,000| 34.681 | 2300

## 平行 分批讀取

分批 | 筆數 | 時間 |
2,000,000 | 10,000,000 | 12.259s
2,500,000 | 10,000,000 | 14.005s
3,000,000 | 10,000,000 | 12.706s, 12.799s
3,500,000 | 10,000,000 | 17.812s, 17.819s
4,000,000 | 10,000,000 | 15.122s
4,000,000 | 10,000,000 | 13.965

## 測試線程數量多寡在平行分批讀取的影響

筆數(萬) | 線程數 | 時間
1,000 | 18 | 18.024s
1,000 | 19 | 14.859s
1,000 | 20 | 15.758s
1,000 | 21 | 16.011s
1,000 | 22 | 16.88s

## 測試線程數量多寡在平行分批讀加上寫入的影響

筆數(萬) | 線程數 | 時間
1,000 | 18 | 17.394s
1,000 | 19 | 21.347s, 17.642s, 17.496s
1,000 | 20 | 17.851s, 18.482s, 17.609s
1,000 | 21 | 17.973s, 20.82s, 16.975s
1,000 | 22 | 18.633s, 18.158s, 18.659s

500 | 18 | 8.317s
500 | 19 | 8.527s
500 | 20 | 9.064s,8.722s
500 | 21 | 8.355s
500 | 22 | 8.797s

## 分批同步處理

分批 | 總筆數(萬) | 時間
3,000,000 | 500 | 11.194s

2,000,000 | 1,000 | 27.558s
2,500,000 | 1,000 | 26.163s
3,000,000 | 1,000 | 25.139s
3,500,000 | 1,000 | 24.534s
4,000,000 | 1,000 | 24.32s

## 比較不同方法的執行時間

方法 | 分批 | 總筆數(萬) | 時間
line by line | 2,000,000 | 1,000 | 27.558s
line by line | 2,500,000 | 1,000 | 32.625 s
line by line | 3,000,000 | 1,000 | 34.097 s
line by line | 3,500,000 | 1,000 | 6.861, 8.222, 18.172 | 33.256
line by line | 4,000,000 | 1,000 | 24.32s

多線程 | 2,000,000 | 1,000 | 27.558s
多線程 | 2,500,000 | 1,000 | 26.163s
多線程 | 3,000,000 | 1,000 | 25.139s
多線程 | 3,500,000 | 1,000 | 24.534s
多線程 | 4,000,000 | 1,000 | 9.955, 13.897, 14.884 | 14.92

# 比較 parallel 使用不同數量的線程

線程數 | 分批 | 總筆數 | 時間(s)
3 | 350 | 7,000 | 89
4 | 350 | 7,000 | 83
5 | 350 | 7,000 | 80.995
6 | 350 | 7,000 | 81.99
7 | 350 | 7,000 | 85.065
8 | 350 | 7,000 | 89.117

# 比較 parallel 使用不同數量的線程(移除手動 GC)

4 | 350 | 7,000 | 88.42, 96.857
5 | 350 | 7,000 | 80.122
6 | 350 | 7,000 | 80.166
7 | 350 | 7,000 | 81.106
8 | 350 | 7,000 | 81.783

第 2 批
開始讀取 3500000 ~ 7000000 筆資料
第 3 批
開始讀取 7000000 ~ 10500000 筆資料
第 1 批
開始讀取 0 ~ 3500000 筆資料
讀取 0 ~ 3500000 筆資料完成，耗時:14.776s
讀取 7000000 ~ 10500000 筆資料完成，耗時:20.932s
讀取 3500000 ~ 7000000 筆資料完成，耗時:20.943s
寫入 0 ~ 3500000 筆資料完成，耗時:38.659s
38.663s
寫入 7000000 ~ 10500000 筆資料完成，耗時:32.229s
32.233s
寫入 3500000 ~ 7000000 筆資料完成，耗時:4.34s
4.344s
程式執行結束
總耗時:90.101 s

# lock

讀取 0 ~ 3500000 筆資料完成，耗時:7.584000110626221s
讀取 3500000 ~ 7000000 筆資料完成，耗時:8.371999740600586s
讀取 7000000 ~ 10500000 筆資料完成，耗時:8.454000473022461s
寫入 0 ~ 3500000 筆資料完成，耗時:1.957s
寫入 3500000 ~ 7000000 筆資料完成，耗時:1.329s
寫入 7000000 ~ 10500000 筆資料完成，耗時:1.124s
全部任務完成,耗時:12.035

# mutex

讀取 0 ~ 3500000 筆資料完成，耗時:8.022000312805176s
讀取 3500000 ~ 7000000 筆資料完成，耗時:9.699999809265137s
讀取 7000000 ~ 10500000 筆資料完成，耗時:10.366999626159668s
寫入 0 ~ 3500000 筆資料完成，耗時:3.22s
寫入 3500000 ~ 7000000 筆資料完成，耗時:2.351s
寫入 7000000 ~ 10500000 筆資料完成，耗時:1.157s
全部任務完成,耗時:14.797

# concurrentBag

讀取 0 ~ 3500000 筆資料完成，耗時:7.379000186920166s
讀取 3500000 ~ 7000000 筆資料完成，耗時:8.37600040435791s
讀取 7000000 ~ 10500000 筆資料完成，耗時:8.468000411987305s
寫入耗時:4.235s
全部任務完成,耗時:12.723

# concurrentQueueu

讀取 0 ~ 3500000 筆資料完成，耗時:7.504000186920166s
讀取 3500000 ~ 7000000 筆資料完成，耗時:8.621999740600586s
讀取 7000000 ~ 10500000 筆資料完成，耗時:8.788000106811523s
寫入耗時:6.314s
全部任務完成,耗時:15.121

# SemaphoreSlim

全部任務完成,耗時:12.95

# ReadWriteLockSlimAsync

第 1 批讀取 0 ~ 3500000 筆資料完成，耗時:7.1s
第 2 批讀取 3500000 ~ 7000000 筆資料完成，耗時:8.007s
第 3 批讀取 7000000 ~ 10500000 筆資料完成，耗時:8.204s
寫入耗時:1.284s
寫入耗時:1.333s
寫入耗時:1.279s
全部任務完成,耗時:12.13

# 2,000

# concurrent

寫入耗時:15.698s
全部任務完成,耗時:36.467
寫入 8.233s 全部任務完成,耗時:26.591

# lock

全部任務完成,耗時:23.163

# 結論

lock 速度最快

高效讀寫 => 先取出線性的單筆讀取最大值
用最大值做 Parallel 分批讀取
並且設定 MaxDegreeOfParallelism(執行續開啟上限) = 5
寫入時 1000 萬筆時，使用 ConcurrentBag 效果最佳
